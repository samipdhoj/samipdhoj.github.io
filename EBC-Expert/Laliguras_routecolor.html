<html>
<head>
 <meta charset="utf-8">
 <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
 <title>Laliguras Routemap</title>
  <link rel="stylesheet" href="https://js.arcgis.com/4.25/esri/themes/light/main.css">
 <style>
  html, body, #viewDiv {
    padding: 0;
    margin: 0;
    height: 100%;
    width: 100%;
  }
  #elevationProfileContainer {
    width: 500px;
    height: 200px;
    margin: 10px;
    border: 1px solid #ccc;
  }
  .esri-elevation-profile.esri-component.esri-widget--panel {
    width: 50vh;
    max-width: 100%;
}
  </style>

  <script src="https://js.arcgis.com/4.25/"></script>
  <script>
require([
    "esri/config",
    "esri/Map",
    "esri/views/SceneView",
    "esri/layers/ElevationLayer",
    "esri/layers/ImageryLayer",
    "esri/PopupTemplate",
    "esri/widgets/Track",
    "esri/Graphic",
    "esri/layers/GraphicsLayer",
    "esri/symbols/SimpleLineSymbol",
    "esri/geometry/SpatialReference",
    "esri/rest/route",
    "esri/rest/support/RouteParameters",
    "esri/rest/support/FeatureSet",
    "esri/geometry/Point",
    "esri/symbols/PictureMarkerSymbol",
    "esri/geometry/Polyline",
    "esri/symbols/SimpleMarkerSymbol",
    "esri/symbols/SimpleLineSymbol",
    "esri/symbols/TextSymbol",
    "esri/widgets/ElevationProfile"
    ,"esri/widgets/ElevationProfile/ElevationProfileViewModel"
  
    ], function(
          esriConfig
        , Map
        , SceneView
        , ElevationLayer
        , ImageryLayer
        , PopupTemplate
        , Track
        , Graphic
        , GraphicsLayer
        , SimpleLineSymbol
        , SpatialReference
        , route
        , RouteParameters
        , FeatureSet
        , Point
        , PictureMarkerSymbol 
        , Polyline
        , SimpleMarkerSymbol
        , SimpleLineSymbol
        , TextSymbol
        , ElevationProfile
        , ElevationProfileViewModel
  
        ) {
  
esriConfig.apiKey = "AAPK0ab1ad9de14c4ec2827bc685240befc2oqSFsxEpdS40T8c6J3R2ES1fu2HdkNKAbQogfMbd6O1DaqWhQjmD_DsO0PZOnMaM";
  
var map = new Map({
    basemap: "satellite",
    ground: "world-elevation",
    maxScale: 100
});
  
var view = new SceneView({
    container: "viewDiv",
    map: map,
    camera: {
        position: {
            x: 86.71263,
            y: 27.59723, 
            z: 5500
        },
        tilt:75
    },
  constraints: {
    tilt: {
      max: 75
    }
  }
});
  
var elevationLayer = new ElevationLayer({
    url: "https://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer"
});
map.add(elevationLayer);
  
var imageryLayer = new ImageryLayer({
  url: "https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"
});
map.add(imageryLayer);

var routeUrl = "https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World";
    
function trailElevation(){
    var elevationProfile = new ElevationProfile({
    view: view,
    sourceElevationLayer: {
    elevationAttribute: "ELEVATION"
  },
    height: "300px",
    width: "100%",
    dockEnabled: false,
    position: "top-right"
  });
  view.ui.add(elevationProfile, "bottom-left");

  }
  
  function router(from, to, color = [255, 0, 0], layer) {
  if (layer == undefined) {
    layer = new GraphicsLayer();
  }
  var location1 = new Point({
    x: from[0],
    y: from[1],
    spatialReference: { wkid: 4326 }
  });

  var location2 = new Point({
    x: to[0],
    y: to[1],
    spatialReference: { wkid: 4326 }
  });

  var graphics = [
    new Graphic({
      geometry: location1,
      symbol: {
        type: "simple-marker",
        color: "black",
        size: "8px"
      }
    }),
    new Graphic({
      geometry: location2,
      symbol: {
        type: "simple-marker",
        color: "black",
        size: "8px"
      }
    })
  ];

  view.graphics.addMany(graphics);

  var routeParams = new RouteParameters({
    stops: new FeatureSet({
      features: graphics
    }),
    returnDirections: true
  });

  route.solve(routeUrl, routeParams)
    .then(function(data) {
      var routeSymbol = new SimpleLineSymbol({
        color: color,
        width: 2
      });

      var routeGraphic = new Graphic({
        geometry: data.routeResults[0].route.geometry,
        symbol: routeSymbol,
        popupTemplate: {
          title: "Route",
          content: "<b>Distance:</b> {distance}<br><b>Time:</b> {time}"
        }
      });

      layer.add(routeGraphic);
      map.add(layer);

      view.on("click", function(event) {
        view.hitTest(event).then(function(response) {
          var feature = response.results[0].graphic;
          if (feature === routeGraphic) {
            feature.symbol = highlightSymbol;
            feature.popupTemplate.visible = true;
            graphicsLayer.refresh();
          }
        });
      });
    });
}


function popupMaster(place, name, elevation, image_url){
  var location = new Point({
    x: place[0],
    y: place[1],
    spatialReference: { wkid: 4326 }
  });

  var graphics = [
    new Graphic({
        geometry: location,
        attributes: {
        name: name,
        elevation: elevation,
        image: image_url
        },
        symbol: {
        type: "simple-marker",
        color: "white",
        size: "8px"
        }
    })
];

var popupTemplate = new PopupTemplate({
    title: "{name}",
    content: '<img src ={image} width="200" height="150"> <p>Elevation: {elevation} ft</p>'
});

    graphics.forEach(function(graphic) {
    graphic.popupTemplate = popupTemplate;
});
    view.graphics.addMany(graphics); 
}

function ImageShower(place, elevation, image_url){
var location = new Point({
    x: place[0],
    y: place[1],
    z: elevation,
    spatialReference: { wkid: 4326 }
  });

  var markerSymbol = new PictureMarkerSymbol({
    url: image_url,
    height: 64,
    width: 64,
    minScale: 2000,
    maxScale: 2500
  });

  var markerGraphic = new Graphic({
    geometry: location,
    symbol: markerSymbol
  });
  view.graphics.add(markerGraphic);

}

function LocationShower(place, elevation, name){
    var textSymbol = {
        type: "text",
        color: [70, 150, 230],
        haloColor: [255, 255, 255],
        haloSize: 1,
        text: name,
        xoffset: 0,
        yoffset: 0,
        zoffset: 1000,
        font: {
            size: 16,
            family: "sans-serif",
            weight: "bold"
        }
  };

  var locatson = new Point({
    x: place[0],
    y: place[1],
    z: elevation,
    spatialReference: { wkid: 4326 }
  });

  var graphik = new Graphic({
    geometry: locatson,
    symbol: textSymbol
  });

  view.graphics.add(graphik);
}

function stand(place, elevation){
  
    var location = new Point({
        x: place[0],
        y: place[1],
        z: 3000,
        spatialReference: { wkid: 4326 }
    });

  var lineSymbol = new SimpleLineSymbol({
    color: [0,0,0],
    width: 8,
    style: "solid"
  });

  var lineGraphic = new Graphic({
    geometry: {
      type: "polyline",
      paths: [[[location.x, location.y, 0], [location.x, location.y, elevation]]]
    },
    symbol: lineSymbol
  });

  view.graphics.addMany([lineGraphic]);

}

Lukla =	[86.73191,	27.68723];
Nachipang =	[86.71474,27.71];
Phakding = [86.71263, 27.74018];
Toktok = [86.71047, 27.75334];
Jorsalle = [86.72206,	27.77898];
Namche_bazar =	[86.70976, 27.8031];

red = [255, 0, 0];
green = [0, 255, 0];
blue = [0, 0, 255];
purple = [255, 0, 255];
yellow = [255, 255, 0];

var elevationProfile;

// trailElevation();

view.when(function(event){

  // If you want to display in same layer, declare the layer here, and pass to the function
  router(Lukla, Nachipang, blue);
  router(Nachipang, Phakding, blue);
  router(Phakding, Toktok, blue);
  router(Toktok, Jorsalle, blue);
  router(Jorsalle, Namche_bazar, blue);

  popupMaster(Lukla, 'Lukla', 10600, "https://raw.githubusercontent.com/Isha-Karn/SQL_Learning/master/Phakding.jpg");
  popupMaster(Nachipang, 'Nachipang', 10600, "https://raw.githubusercontent.com/Isha-Karn/SQL_Learning/master/Phakding.jpg");
  popupMaster(Phakding, 'Phakding', 10600, "https://raw.githubusercontent.com/Isha-Karn/SQL_Learning/master/Phakding.jpg");
  popupMaster(Toktok, 'Toktok', 10600, "https://raw.githubusercontent.com/Isha-Karn/SQL_Learning/master/Phakding.jpg");
  popupMaster(Jorsalle, 'Jorsalle', 10600, "https://raw.githubusercontent.com/Isha-Karn/SQL_Learning/master/Phakding.jpg");
  popupMaster(Namche_bazar, 'Namche_bazar', 10600, "https://raw.githubusercontent.com/Isha-Karn/SQL_Learning/master/Phakding.jpg");
  
});
  
setTimeout(function() {

  LocationShower(Lukla, 3200, "Lukla");
  stand(Lukla, 3200)

  LocationShower(Nachipang, 2900, "Nachhipang");
  stand(Nachipang, 2900)

  LocationShower(Phakding, 3000, "Phakding");
  stand(Phakding, 3000)

  LocationShower(Toktok, 3000, "Toktok");
  stand(Toktok, 3000)

  LocationShower(Jorsalle, 3000, "Jorsalle");
  stand(Jorsalle, 3000)

  LocationShower(Namche_bazar, 4000, "Namche bazar");
  stand(Namche_bazar, 4000)

}, 5000);
    
ImageShower(Namche_bazar, 3500, "https://raw.githubusercontent.com/Isha-Karn/SQL_Learning/master/laliguras-removebg-preview.png")

});
  </script>
  </head>
  <body>
    <div id="viewDiv"></div>
    <div class="container-fluid" style="background-color: rgba(234, 153, 72, 0.709) !important; color: rgb(227, 146, 66); border: 3px solid; ">
      <div id="ColCard">
          <div class="container accordion" id="myAccordion">
              <div class="card" style="background-color: rgb(255, 255, 255) !important;">
                  <div class="card-header" style="background-color: rgba(0, 174, 255, 0.52) !important;"
                      id="item1Header">
                      <h5>
                          <button class="btn btn-link collapsed" type="button" data-toggle="collapse"
                              aria-expanded="true" data-target="#expandable1" aria-controls="expandable1">
                              <p style="color:rgb(255, 255, 255)"><b>Leg 1</b></p>
                          </button>
                      </h5>
                  </div>
                  <div id="expandable1" class="collapse show" aria-labelledby="item1Header"
                      data-parent="#myAccordion">
                      <div class="card-body">
                          <div class="row p-0 p-lg-1">
                              <div class="column">Start</div>
                              <div class="column">Lukla (2860 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">End</div>
                              <div class="column">Nachipang (2730 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Distance</div>
                              <div class="column">15.2 km</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Elevation</div>
                              <div class="column">7 km 8.2 km</div>
                          </div>
                          <!-- <div class="row p-0 p-lg-1">
                          <div class="column">Staying @</div>
                          <div class="column">Nachipang lodge <button type="button">Booked</button>
                          </div>
                      </div> -->
                          <div class="row p-0 p-lg-1">
                              <div class="column">Duration</div>
                              <div class="column">6 hrs</div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="card">
                  <div class="card-header" id="item2Header"
                      style="background-color: rgba(0, 174, 255, 0.52) !important;">
                      <h5 class="mb-0">
                          <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#expandable2"
                              aria-controls="expandable2">
                              <p style="color:rgb(255, 255, 255)"><b>Leg 2</b></p>
                          </button>
                      </h5>
                  </div>
                  <div id="expandable2" class="collapse" aria-labelledby="item2Header" data-parent="#myAccordion">
                      <div class="card-body">
                          <div class="row p-0 p-lg-1">
                              <div class="column">Start</div>
                              <div class="column">Lukla (2860 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">End</div>
                              <div class="column">Nachipang (2730 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Distance</div>
                              <div class="column">15.2 km</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Elevation</div>
                              <div class="column">7 km 8.2 km</div>
                          </div>
                          <!-- <div class="row p-0 p-lg-1">
                          <div class="column">Staying @</div>
                          <div class="column">Nachipang lodge <button type="button">Booked</button></div>
                      </div> -->
                          <div class="row p-0 p-lg-1">
                              <div class="column">Duration</div>
                              <div class="column">6 hrs</div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="card">
                  <div class="card-header" id="item3Header"
                      style="background-color: rgba(0, 174, 255, 0.52) !important;">
                      <h5 class="mb-0">
                          <button class="btn
                                                                            btn-link
                                                                            collapsed" type="button"
                              data-toggle="collapse" data-target="#expandable3" aria-expanded="false"
                              aria-controls="expandable3">
                              <p style="color:rgb(255, 255, 255)"><b>Leg 3</b></p>
                          </button>
                      </h5>
                  </div>
                  <div id="expandable3" class="collapse" aria-labelledby="item3Header" data-parent="#myAccordion">
                      <div class="card-body">
                          <div class="row p-0 p-lg-1">
                              <div class="column">Start</div>
                              <div class="column">Lukla (2860 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">End</div>
                              <div class="column">Nachipang (2730 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Distance</div>
                              <div class="column">15.2 km</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Elevation</div>
                              <div class="column">7 km 8.2 km</div>
                          </div>
                          <!-- <div class="row p-0 p-lg-1">
                          <div class="column">Staying @</div>
                          <div class="column">Nachipang lodge <button type="button">Booked</button></div>
                      </div> -->
                          <div class="row p-0 p-lg-1">
                              <div class="column">Duration</div>
                              <div class="column">6 hrs</div>
                          </div>
                      </div>
                  </div>
              </div>
              <div class="card">
                  <div class="card-header" id="item4Header"
                      style="background-color: rgba(0, 174, 255, 0.52) !important;">
                      <h5 class="mb-0">
                          <button class="btn
                                                                            btn-link
                                                                            collapsed" type="button"
                              data-toggle="collapse" data-target="#expandable4" aria-expanded="false"
                              aria-controls="expandable4">
                              <p style="color:rgb(255, 255, 255)"><b>Leg 4</b></p>
                          </button>
                      </h5>
                  </div>
                  <div id="expandable4" class="collapse" aria-labelledby="item4Header" data-parent="#myAccordion">
                      <div class="card-body">
                          <div class="row p-0 p-lg-1">
                              <div class="column">Start</div>
                              <div class="column">Lukla (2860 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">End</div>
                              <div class="column">Nachipang (2730 m)</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Distance</div>
                              <div class="column">15.2 km</div>
                          </div>
                          <div class="row p-0 p-lg-1">
                              <div class="column">Elevation</div>
                              <div class="column">7 km 8.2 km</div>
                          </div>
                          <!-- <div class="row p-0 p-lg-1">
                          <div class="column">Staying @</div>
                          <div class="column">Nachipang lodge <button type="button">Booked</button></div>
                      </div> -->
                          <div class="row p-0 p-lg-1">
                              <div class="column">Duration</div>
                              <div class="column">6 hrs</div>
                          </div>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
  </body>
</html>